<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Data Transformation | Women’s and Minorities’ Working Opportunities in New York City from 1850 to 1940</title>
  <meta name="description" content="Chapter 3 Data Transformation | Women’s and Minorities’ Working Opportunities in New York City from 1850 to 1940" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Data Transformation | Women’s and Minorities’ Working Opportunities in New York City from 1850 to 1940" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Data Transformation | Women’s and Minorities’ Working Opportunities in New York City from 1850 to 1940" />
  
  
  

<meta name="author" content="Luwei Zhang, Guangyu Wu, Jingxiang Zhang" />


<meta name="date" content="2021-12-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-sources.html"/>
<link rel="next" href="missing-values.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">NYC-Minority-Working-Conditions</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="data-sources.html"><a href="data-sources.html"><i class="fa fa-check"></i><b>2</b> Data Sources</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-sources.html"><a href="data-sources.html#introduction-of-data-source"><i class="fa fa-check"></i><b>2.1</b> Introduction of Data Source</a></li>
<li class="chapter" data-level="2.2" data-path="data-sources.html"><a href="data-sources.html#data-generation-process"><i class="fa fa-check"></i><b>2.2</b> Data Generation Process</a></li>
<li class="chapter" data-level="2.3" data-path="data-sources.html"><a href="data-sources.html#data-extraction-workflow"><i class="fa fa-check"></i><b>2.3</b> Data Extraction Workflow</a></li>
<li class="chapter" data-level="2.4" data-path="data-sources.html"><a href="data-sources.html#choice-of-variables"><i class="fa fa-check"></i><b>2.4</b> Choice of Variables</a></li>
<li class="chapter" data-level="2.5" data-path="data-sources.html"><a href="data-sources.html#issues-with-the-data"><i class="fa fa-check"></i><b>2.5</b> Issues with the Data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-transformation.html"><a href="data-transformation.html"><i class="fa fa-check"></i><b>3</b> Data Transformation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-transformation.html"><a href="data-transformation.html#import-packages-and-dataset"><i class="fa fa-check"></i><b>3.1</b> Import Packages and Dataset</a></li>
<li class="chapter" data-level="3.2" data-path="data-transformation.html"><a href="data-transformation.html#reduce-cardinality-and-decode-data"><i class="fa fa-check"></i><b>3.2</b> Reduce Cardinality and Decode Data</a></li>
<li class="chapter" data-level="3.3" data-path="data-transformation.html"><a href="data-transformation.html#handling-na-special-cases-and-enforce-data-types"><i class="fa fa-check"></i><b>3.3</b> Handling N/A, Special Cases and Enforce Data Types</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="missing-values.html"><a href="missing-values.html"><i class="fa fa-check"></i><b>4</b> Missing Values</a></li>
<li class="chapter" data-level="5" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>5</b> Results</a>
<ul>
<li class="chapter" data-level="5.1" data-path="results.html"><a href="results.html#working-conditions"><i class="fa fa-check"></i><b>5.1</b> Working Conditions</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="results.html"><a href="results.html#gender-and-employment"><i class="fa fa-check"></i><b>5.1.1</b> Gender and Employment</a></li>
<li class="chapter" data-level="5.1.2" data-path="results.html"><a href="results.html#race-and-employment"><i class="fa fa-check"></i><b>5.1.2</b> Race and Employment</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="results.html"><a href="results.html#education-and-employment"><i class="fa fa-check"></i><b>5.2</b> Education and Employment</a></li>
<li class="chapter" data-level="5.3" data-path="results.html"><a href="results.html#time-series-and-employment"><i class="fa fa-check"></i><b>5.3</b> Time series and Employment</a></li>
<li class="chapter" data-level="5.4" data-path="results.html"><a href="results.html#conclusion"><i class="fa fa-check"></i><b>5.4</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="interactive-component.html"><a href="interactive-component.html"><i class="fa fa-check"></i><b>6</b> Interactive component</a></li>
<li class="chapter" data-level="7" data-path="conclusion-1.html"><a href="conclusion-1.html"><i class="fa fa-check"></i><b>7</b> Conclusion</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Women’s and Minorities’ Working Opportunities in New York City from 1850 to 1940</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-transformation" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Data Transformation</h1>
<div id="import-packages-and-dataset" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Import Packages and Dataset</h2>
<p>IPUMSR is a powerful package developed to “import census, survey and geographic data provided by ‘IPUMS’ into R plus tools to help use the associated metadata to make analysis easier” <a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>.</p>
<p>Here, we use the function <code>read_ipums_ddi</code> to read in the data codebook, which is downloaded along with the extract and stored in XML format. In an R development environment such as RStudio, you can use the command <code>ipums_view(ddi)</code> to open an interactive codebook through the built-in viewer.</p>
<p>Then, we can use <code>read_ipums_micro(ddi)</code> to load the actual dataset into the environment, given data file is placed next the XML codebook.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="data-transformation.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ipumsr) </span>
<span id="cb1-2"><a href="data-transformation.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) </span>
<span id="cb1-3"><a href="data-transformation.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-4"><a href="data-transformation.html#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="data-transformation.html#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in codebook</span></span>
<span id="cb1-6"><a href="data-transformation.html#cb1-6" aria-hidden="true" tabindex="-1"></a>ddi <span class="ot">&lt;-</span> <span class="fu">read_ipums_ddi</span>(<span class="st">&quot;./data/usa_00038.xml&quot;</span>)</span>
<span id="cb1-7"><a href="data-transformation.html#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in data</span></span>
<span id="cb1-8"><a href="data-transformation.html#cb1-8" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(ddi)</span></code></pre></div>
<pre><code>## Use of data from IPUMS USA is subject to conditions including that users should
## cite the data appropriately. Use command `ipums_conditions()` for more details.</code></pre>
</div>
<div id="reduce-cardinality-and-decode-data" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Reduce Cardinality and Decode Data</h2>
<p>As discussed in the previous chapter, one issue with the data is that some variables have a high cardinality with roughly even proportion. For these categories, we cannot lump the minority values into the Other category. For this project, we collect the multi-layer categorization from the IPUMS documentation to cluster the occupation and industry into larger categories <a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>. We also make a decision to use <code>lbl_na_if</code> function from IPUMSR to mark non-occupational responses such as “keeping house” as missing values.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="data-transformation.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove varialbes with lower usability, as explained in previous chapter</span></span>
<span id="cb3-2"><a href="data-transformation.html#cb3-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(SERIAL, PERNUM, RELATED, RACED, BPLD, MBPLD, FBPLD, YRSUSA2, MTONGUE, MTONGUED, PRESGL))</span>
<span id="cb3-3"><a href="data-transformation.html#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="data-transformation.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Data augmentation for categories of occupations and industries</span></span>
<span id="cb3-5"><a href="data-transformation.html#cb3-5" aria-hidden="true" tabindex="-1"></a>occ_cat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;./data/occupation_categories.csv&quot;</span>)</span>
<span id="cb3-6"><a href="data-transformation.html#cb3-6" aria-hidden="true" tabindex="-1"></a>ind_cat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;./data/industry_categories.csv&quot;</span>)</span>
<span id="cb3-7"><a href="data-transformation.html#cb3-7" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(data, occ_cat, <span class="at">by =</span><span class="st">&#39;OCC1950&#39;</span>)</span>
<span id="cb3-8"><a href="data-transformation.html#cb3-8" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(data, ind_cat, <span class="at">by =</span><span class="st">&#39;IND1950&#39;</span>)</span>
<span id="cb3-9"><a href="data-transformation.html#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="data-transformation.html#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># NA relabeling based on code range</span></span>
<span id="cb3-11"><a href="data-transformation.html#cb3-11" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>OCC1950 <span class="ot">&lt;-</span> <span class="fu">lbl_na_if</span>(data<span class="sc">$</span>OCC1950, <span class="sc">~</span>.val <span class="sc">&gt;</span> <span class="dv">970</span>) <span class="sc">%&gt;%</span> <span class="fu">as_factor</span>()</span>
<span id="cb3-12"><a href="data-transformation.html#cb3-12" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>IND1950 <span class="ot">&lt;-</span> <span class="fu">lbl_na_if</span>(data<span class="sc">$</span>IND1950, <span class="sc">~</span>.val <span class="sc">&gt;=</span> <span class="dv">975</span> <span class="sc">|</span> .val <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">as_factor</span>()</span>
<span id="cb3-13"><a href="data-transformation.html#cb3-13" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>OCCSCORE <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(data<span class="sc">$</span>OCCSCORE)</span>
<span id="cb3-14"><a href="data-transformation.html#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="data-transformation.html#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Factorize columns</span></span>
<span id="cb3-16"><a href="data-transformation.html#cb3-16" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">as_factor</span>(data)</span></code></pre></div>
</div>
<div id="handling-na-special-cases-and-enforce-data-types" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Handling N/A, Special Cases and Enforce Data Types</h2>
<p>The other data issue (tail values) is addressed through a series of column-specific data transformations. More specifically, we handle different codes for N/A, collapse tail values into larger categories, and ensure that all values are in the correct data type for that column. When the meaning is clear, we also trim the value to make it concise. The resulting dataset is saved as a CSV file for downstream analysis.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="data-transformation.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Customized cleaning for each column</span></span>
<span id="cb4-2"><a href="data-transformation.html#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="data-transformation.html#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># YEAR</span></span>
<span id="cb4-4"><a href="data-transformation.html#cb4-4" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>YEAR <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(df<span class="sc">$</span>YEAR))</span>
<span id="cb4-5"><a href="data-transformation.html#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># CITY</span></span>
<span id="cb4-6"><a href="data-transformation.html#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># FAMSIZE</span></span>
<span id="cb4-7"><a href="data-transformation.html#cb4-7" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>FAMSIZE <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df<span class="sc">$</span>FAMSIZE)</span>
<span id="cb4-8"><a href="data-transformation.html#cb4-8" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>FAMSIZE[df<span class="sc">$</span>FAMSIZE <span class="sc">==</span> <span class="st">&quot;1 family member present&quot;</span>] <span class="ot">=</span> <span class="st">&quot;1&quot;</span></span>
<span id="cb4-9"><a href="data-transformation.html#cb4-9" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>FAMSIZE[df<span class="sc">$</span>FAMSIZE <span class="sc">==</span> <span class="st">&quot;2 family members present&quot;</span>] <span class="ot">=</span> <span class="st">&quot;2&quot;</span></span>
<span id="cb4-10"><a href="data-transformation.html#cb4-10" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>FAMSIZE <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>FAMSIZE)</span>
<span id="cb4-11"><a href="data-transformation.html#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># RELATE</span></span>
<span id="cb4-12"><a href="data-transformation.html#cb4-12" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>RELATE <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df<span class="sc">$</span>RELATE)</span>
<span id="cb4-13"><a href="data-transformation.html#cb4-13" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>RELATE[df<span class="sc">$</span>RELATE <span class="sc">==</span> <span class="st">&quot;Head/Householder&quot;</span>] <span class="ot">=</span> <span class="st">&quot;Head&quot;</span></span>
<span id="cb4-14"><a href="data-transformation.html#cb4-14" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>RELATE[df<span class="sc">$</span>RELATE <span class="sc">==</span> <span class="st">&quot;Child-in-law&quot;</span>] <span class="ot">=</span> <span class="st">&quot;Child&quot;</span></span>
<span id="cb4-15"><a href="data-transformation.html#cb4-15" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>RELATE[df<span class="sc">$</span>RELATE <span class="sc">==</span> <span class="st">&quot;Grandchild&quot;</span>] <span class="ot">=</span> <span class="st">&quot;Child&quot;</span></span>
<span id="cb4-16"><a href="data-transformation.html#cb4-16" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>RELATE[df<span class="sc">$</span>RELATE <span class="sc">==</span> <span class="st">&quot;Parent-in-Law&quot;</span>] <span class="ot">=</span> <span class="st">&quot;Parent&quot;</span></span>
<span id="cb4-17"><a href="data-transformation.html#cb4-17" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>RELATE[df<span class="sc">$</span>RELATE <span class="sc">==</span> <span class="st">&quot;Sibling-in-Law&quot;</span>] <span class="ot">=</span> <span class="st">&quot;Sibling&quot;</span></span>
<span id="cb4-18"><a href="data-transformation.html#cb4-18" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>RELATE[df<span class="sc">$</span>RELATE <span class="sc">==</span> <span class="st">&quot;Other relatives&quot;</span>] <span class="ot">=</span> <span class="st">&quot;Relative&quot;</span></span>
<span id="cb4-19"><a href="data-transformation.html#cb4-19" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>RELATE[df<span class="sc">$</span>RELATE <span class="sc">==</span> <span class="st">&quot;Partner, friend, visitor&quot;</span>] <span class="ot">=</span> <span class="st">&quot;Relative&quot;</span></span>
<span id="cb4-20"><a href="data-transformation.html#cb4-20" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>RELATE[df<span class="sc">$</span>RELATE <span class="sc">==</span> <span class="st">&quot;Other non-relatives&quot;</span>] <span class="ot">=</span> <span class="st">&quot;Other&quot;</span></span>
<span id="cb4-21"><a href="data-transformation.html#cb4-21" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>RELATE[df<span class="sc">$</span>RELATE <span class="sc">==</span> <span class="st">&quot;Institutional inmates&quot;</span>] <span class="ot">=</span> <span class="st">&quot;Inmate&quot;</span></span>
<span id="cb4-22"><a href="data-transformation.html#cb4-22" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>RELATE <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df<span class="sc">$</span>RELATE)</span>
<span id="cb4-23"><a href="data-transformation.html#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co"># SEX</span></span>
<span id="cb4-24"><a href="data-transformation.html#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co"># AGE</span></span>
<span id="cb4-25"><a href="data-transformation.html#cb4-25" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>AGE <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df<span class="sc">$</span>AGE)</span>
<span id="cb4-26"><a href="data-transformation.html#cb4-26" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>AGE[df<span class="sc">$</span>AGE <span class="sc">==</span> <span class="st">&quot;Less than 1 year old&quot;</span>] <span class="ot">=</span> <span class="st">&quot;0&quot;</span></span>
<span id="cb4-27"><a href="data-transformation.html#cb4-27" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>AGE[df<span class="sc">$</span>AGE <span class="sc">==</span> <span class="st">&quot;90 (90+ in 1980 and 1990)&quot;</span>] <span class="ot">=</span> <span class="st">&quot;90&quot;</span></span>
<span id="cb4-28"><a href="data-transformation.html#cb4-28" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>AGE[df<span class="sc">$</span>AGE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;100 (100+ in 1960-1970)&quot;</span>, <span class="st">&quot;112 (112+ in the 1980 internal data)&quot;</span>, <span class="st">&quot;115 (115+ in the 1990 internal data)&quot;</span>)] <span class="ot">=</span> <span class="st">&quot;100&quot;</span></span>
<span id="cb4-29"><a href="data-transformation.html#cb4-29" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>AGE <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>AGE)</span>
<span id="cb4-30"><a href="data-transformation.html#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co"># MARST</span></span>
<span id="cb4-31"><a href="data-transformation.html#cb4-31" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>MARST <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df<span class="sc">$</span>MARST)</span>
<span id="cb4-32"><a href="data-transformation.html#cb4-32" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>MARST[df<span class="sc">$</span>MARST <span class="sc">==</span> <span class="st">&#39;Married, spouse present&#39;</span>] <span class="ot">=</span> <span class="st">&#39;Married&#39;</span></span>
<span id="cb4-33"><a href="data-transformation.html#cb4-33" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>MARST[df<span class="sc">$</span>MARST <span class="sc">==</span> <span class="st">&#39;Never married/single&#39;</span>] <span class="ot">=</span> <span class="st">&#39;Single&#39;</span></span>
<span id="cb4-34"><a href="data-transformation.html#cb4-34" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>MARST[df<span class="sc">$</span>MARST <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Married, spouse absent&#39;</span>,<span class="st">&#39;Separated&#39;</span>,<span class="st">&#39;Divorced&#39;</span>,<span class="st">&#39;Widowed&#39;</span>)] <span class="ot">=</span> <span class="st">&#39;Widowed or Divorced&#39;</span></span>
<span id="cb4-35"><a href="data-transformation.html#cb4-35" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>MARST <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df<span class="sc">$</span>MARST)</span>
<span id="cb4-36"><a href="data-transformation.html#cb4-36" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>MARST <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df<span class="sc">$</span>MARST)</span>
<span id="cb4-37"><a href="data-transformation.html#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="co"># RACE</span></span>
<span id="cb4-38"><a href="data-transformation.html#cb4-38" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>RACE <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df<span class="sc">$</span>RACE)</span>
<span id="cb4-39"><a href="data-transformation.html#cb4-39" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>RACE[df<span class="sc">$</span>RACE <span class="sc">==</span> <span class="st">&#39;Black/African American/Negro&#39;</span>] <span class="ot">=</span> <span class="st">&#39;Black&#39;</span></span>
<span id="cb4-40"><a href="data-transformation.html#cb4-40" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>RACE[<span class="sc">!</span>(df<span class="sc">$</span>RACE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;White&#39;</span>,<span class="st">&#39;Black&#39;</span>))] <span class="ot">=</span> <span class="st">&#39;Other&#39;</span></span>
<span id="cb4-41"><a href="data-transformation.html#cb4-41" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>RACE <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df<span class="sc">$</span>RACE)</span>
<span id="cb4-42"><a href="data-transformation.html#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="co"># BPL</span></span>
<span id="cb4-43"><a href="data-transformation.html#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="co"># MBPL</span></span>
<span id="cb4-44"><a href="data-transformation.html#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="co"># FBPL</span></span>
<span id="cb4-45"><a href="data-transformation.html#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="co"># NATIVITY</span></span>
<span id="cb4-46"><a href="data-transformation.html#cb4-46" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>NATIVITY <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df<span class="sc">$</span>NATIVITY)</span>
<span id="cb4-47"><a href="data-transformation.html#cb4-47" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>NATIVITY[df<span class="sc">$</span>NATIVITY <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Native born, and both parents native born&quot;</span>,<span class="st">&quot;Native born, and father foreign, mother native&quot;</span>,<span class="st">&quot;Native born, and mother foreign, father native&quot;</span>)] <span class="ot">=</span> <span class="st">&#39;Native born with native parent&#39;</span></span>
<span id="cb4-48"><a href="data-transformation.html#cb4-48" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>NATIVITY[df<span class="sc">$</span>NATIVITY <span class="sc">==</span> <span class="st">&#39;Native born, and both parents foreign&#39;</span>] <span class="ot">=</span> <span class="st">&#39;Native born with foreign parent&#39;</span></span>
<span id="cb4-49"><a href="data-transformation.html#cb4-49" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>NATIVITY[df<span class="sc">$</span>NATIVITY <span class="sc">==</span> <span class="st">&#39;N/A&#39;</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb4-50"><a href="data-transformation.html#cb4-50" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>NATIVITY <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df<span class="sc">$</span>NATIVITY)</span>
<span id="cb4-51"><a href="data-transformation.html#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="co"># CITIZEN</span></span>
<span id="cb4-52"><a href="data-transformation.html#cb4-52" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>CITIZEN <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df<span class="sc">$</span>CITIZEN)</span>
<span id="cb4-53"><a href="data-transformation.html#cb4-53" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>CITIZEN[df<span class="sc">$</span>CITIZEN <span class="sc">==</span> <span class="st">&#39;Not a citizen, but has received first papers&#39;</span>] <span class="ot">=</span> <span class="st">&#39;Applying citizenship&#39;</span></span>
<span id="cb4-54"><a href="data-transformation.html#cb4-54" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>CITIZEN[<span class="sc">!</span>(df<span class="sc">$</span>CITIZEN <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Naturalized citizen&#39;</span>,<span class="st">&#39;Not a citizen&#39;</span>, <span class="st">&#39;Applying citizenship&#39;</span>))] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb4-55"><a href="data-transformation.html#cb4-55" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>CITIZEN <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df<span class="sc">$</span>CITIZEN)</span>
<span id="cb4-56"><a href="data-transformation.html#cb4-56" aria-hidden="true" tabindex="-1"></a><span class="co"># YRIMMIG</span></span>
<span id="cb4-57"><a href="data-transformation.html#cb4-57" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>YRIMMIG <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df<span class="sc">$</span>YRIMMIG)</span>
<span id="cb4-58"><a href="data-transformation.html#cb4-58" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>YRIMMIG <span class="ot">=</span> <span class="fu">str_replace</span>(df<span class="sc">$</span>YRIMMIG, <span class="st">&quot; </span><span class="sc">\\</span><span class="st">s*</span><span class="sc">\\</span><span class="st">([^</span><span class="sc">\\</span><span class="st">)]+</span><span class="sc">\\</span><span class="st">)&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb4-59"><a href="data-transformation.html#cb4-59" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>YRIMMIG[df<span class="sc">$</span>YRIMMIG <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;N/A&#39;</span>, <span class="st">&#39;Not reported&#39;</span>)] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb4-60"><a href="data-transformation.html#cb4-60" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>YRIMMIG <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>YRIMMIG)</span>
<span id="cb4-61"><a href="data-transformation.html#cb4-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating Years spent in US variable</span></span>
<span id="cb4-62"><a href="data-transformation.html#cb4-62" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb4-63"><a href="data-transformation.html#cb4-63" aria-hidden="true" tabindex="-1"></a> <span class="fu">mutate</span>(</span>
<span id="cb4-64"><a href="data-transformation.html#cb4-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">YRINUSA =</span> YEAR <span class="sc">-</span> YRIMMIG</span>
<span id="cb4-65"><a href="data-transformation.html#cb4-65" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb4-66"><a href="data-transformation.html#cb4-66" aria-hidden="true" tabindex="-1"></a><span class="co"># SCHOOL</span></span>
<span id="cb4-67"><a href="data-transformation.html#cb4-67" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>SCHOOL <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df<span class="sc">$</span>SCHOOL)</span>
<span id="cb4-68"><a href="data-transformation.html#cb4-68" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>SCHOOL[df<span class="sc">$</span>SCHOOL <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;N/A&quot;</span>, <span class="st">&quot;Unknown&quot;</span>, <span class="st">&quot;Missing&quot;</span>)] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb4-69"><a href="data-transformation.html#cb4-69" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>SCHOOL <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df<span class="sc">$</span>SCHOOL)</span>
<span id="cb4-70"><a href="data-transformation.html#cb4-70" aria-hidden="true" tabindex="-1"></a><span class="co"># LIT</span></span>
<span id="cb4-71"><a href="data-transformation.html#cb4-71" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>LIT <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df<span class="sc">$</span>LIT)</span>
<span id="cb4-72"><a href="data-transformation.html#cb4-72" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>LIT[df<span class="sc">$</span>LIT <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Yes, literate (reads and writes)&quot;</span>,<span class="st">&quot;Cannot read, can write&quot;</span>,<span class="st">&quot;Cannot write, can read&quot;</span>)] <span class="ot">=</span> <span class="st">&#39;Yes, literate&#39;</span></span>
<span id="cb4-73"><a href="data-transformation.html#cb4-73" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>LIT[df<span class="sc">$</span>LIT <span class="sc">==</span> <span class="st">&#39;No, illiterate (cannot read or write)&#39;</span>] <span class="ot">=</span> <span class="st">&#39;No, illiterate&#39;</span></span>
<span id="cb4-74"><a href="data-transformation.html#cb4-74" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>LIT[df<span class="sc">$</span>LIT <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;N/A&quot;</span>, <span class="st">&quot;Unknown, illegible or blank&quot;</span>)] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb4-75"><a href="data-transformation.html#cb4-75" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>LIT <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df<span class="sc">$</span>LIT)</span>
<span id="cb4-76"><a href="data-transformation.html#cb4-76" aria-hidden="true" tabindex="-1"></a><span class="co"># LABFORCE</span></span>
<span id="cb4-77"><a href="data-transformation.html#cb4-77" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>LABFORCE <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df<span class="sc">$</span>LABFORCE)</span>
<span id="cb4-78"><a href="data-transformation.html#cb4-78" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>LABFORCE[df<span class="sc">$</span>LABFORCE <span class="sc">==</span> <span class="st">&#39;N/A&#39;</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb4-79"><a href="data-transformation.html#cb4-79" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>LABFORCE <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df<span class="sc">$</span>LABFORCE)</span>
<span id="cb4-80"><a href="data-transformation.html#cb4-80" aria-hidden="true" tabindex="-1"></a><span class="co"># OCC1950</span></span>
<span id="cb4-81"><a href="data-transformation.html#cb4-81" aria-hidden="true" tabindex="-1"></a><span class="co"># IND1950</span></span>
<span id="cb4-82"><a href="data-transformation.html#cb4-82" aria-hidden="true" tabindex="-1"></a><span class="co"># INCWAGE</span></span>
<span id="cb4-83"><a href="data-transformation.html#cb4-83" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>INCWAGE <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df<span class="sc">$</span>INCWAGE)</span>
<span id="cb4-84"><a href="data-transformation.html#cb4-84" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>INCWAGE[df<span class="sc">$</span>INCWAGE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;N/A&#39;</span>,<span class="st">&#39;Missing&#39;</span>)] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb4-85"><a href="data-transformation.html#cb4-85" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>INCWAGE <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>INCWAGE)</span>
<span id="cb4-86"><a href="data-transformation.html#cb4-86" aria-hidden="true" tabindex="-1"></a><span class="co"># OCCSCORE</span></span>
<span id="cb4-87"><a href="data-transformation.html#cb4-87" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>OCCSCORE[df<span class="sc">$</span>OCCSCORE <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb4-88"><a href="data-transformation.html#cb4-88" aria-hidden="true" tabindex="-1"></a><span class="co"># EDSCOR50</span></span>
<span id="cb4-89"><a href="data-transformation.html#cb4-89" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>EDSCOR50 <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df<span class="sc">$</span>EDSCOR50)</span>
<span id="cb4-90"><a href="data-transformation.html#cb4-90" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>EDSCOR50[df<span class="sc">$</span>EDSCOR50 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;N/A&#39;</span>)] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb4-91"><a href="data-transformation.html#cb4-91" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>EDSCOR50 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>EDSCOR50)</span>
<span id="cb4-92"><a href="data-transformation.html#cb4-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-93"><a href="data-transformation.html#cb4-93" aria-hidden="true" tabindex="-1"></a><span class="co"># Output data</span></span>
<span id="cb4-94"><a href="data-transformation.html#cb4-94" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df, <span class="at">file =</span> <span class="st">&#39;./data/ipums.csv&#39;</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code></pre></div>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="3">
<li id="fn3"><p>Ellis, Burk, Grover, Minnesota Population Center (2017). ipumsr: Read ‘IPUMS’ Extract Files. R package version 0.4.5. <a href="https://cran.r-project.org/web/packages/ipumsr/index.html" class="uri">https://cran.r-project.org/web/packages/ipumsr/index.html</a><a href="data-transformation.html#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p><a href="https://usa.ipums.org/usa-action/variables/OCC1950#codes_section" class="uri">https://usa.ipums.org/usa-action/variables/OCC1950#codes_section</a><a href="data-transformation.html#fnref4" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-sources.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="missing-values.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/EDAV-final-project-group23/EDAV-Final-Group23/edit/main/03-cleaning.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/EDAV-final-project-group23/EDAV-Final-Group23/blob/main/03-cleaning.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
